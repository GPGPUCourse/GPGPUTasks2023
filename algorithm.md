Дан массив a.

На хосте:
1. Разбить массив на воркгруппы;
2. На хосте итерируемся по маске по k бит, начиная с младших;
3. Сортируем merge сортом массив a до сортированных кусков размера воркгруппы (1 << k);
4. Запускаем кернел calc_counters, получим массив counters;
5. Транспонируем матрицу counters в матрицу counters_t;
6. Запускаем алгоритм префиксных сумм на counters, сохранив ее в массиве sums;
7. Запускаем алгоритм префиксных сумм на counters_t, сохранив ее в массиве sums_t;
8. Запускаем кернел radix_sort;


Кернел calc_counters:
1. В кернеле считаем локальный массив счетчиков каждого отмаскированного числа (local_counters), используя атомарное прибавление;
2. Копируем этот массив в глобальный массив counters с coalesced доступом (получается размер воркгруппы должен быть 2^k);


Кернел radix_sort:
1. Наше число в массиве a в воркгруппе на позиции i;
2. Получаем отмаскированное значение числа - m;
3. Наша воркгруппа с номером wg;
4. Тогда позиция в res = sums_t[m][wg-1] + i - (sums[wg][m-1] - sums[wg-1][2^k-1])
5. Пишем наше число в res по вычисленному индексу